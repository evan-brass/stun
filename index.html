<!DOCTYPE html>
<script type="_module">
const server = new RTCPeerConnection();

await server.setRemoteDescription({
	type: 'offer',
	sdp: [
		'v=0',
		'o=swbrd 42 0 IN IP4 0.0.0.0',
		's=-',
		't=0 0',
		'a=group:BUNDLE dc',
		'a=fingerprint:sha-256 C3:E4:A4:B9:DD:56:08:7E:A6:15:5E:F7:EB:0F:BD:24:EB:C4:D4:AD:92:33:91:31:F4:37:3E:C5:57:44:11:D5',
		'a=ice-ufrag:ucCm6JK3s22XuCRiTZVFpWajUq0tIpB7lDn1Sv8dRv3',
		'a=ice-pwd:the/ice/password/constant',
		// 'a=ice-lite',
		'm=application 1 UDP/DTLS/SCTP webrtc-datachannel',
		'c=IN IP4 0.0.0.0',
		'a=mid:dc',
		// 'a=candidate:v6 1 udp 42 2600:1900:4041:7f1:: 3478 typ host',
		// 'a=candidate:v4 1 udp 42 35.227.165.49 3478 typ host',
		'a=candidate:v6 1 udp 42 ::1 3478 typ host',
		'a=candidate:v4 1 udp 42 127.0.0.1 3478 typ host',
		'a=setup:passive',
		'a=sctp-port:5000',
		''
	].join('\n')
});
await server.setLocalDescription();
</script>
<script type="module">
const username = 'guest';
const credential = 'password';
const config = {
	iceTransportPolicy: 'relay',
	iceServers: [{
		// urls: 'turn:stun.evan-brass.net',
		urls: 'turn:127.0.0.1',
		username: 'guest',
		credential: 'password',
	}],
};

const a = new RTCPeerConnection(config);
const b = new RTCPeerConnection(config);

a.addEventListener('connectionstatechange', () => console.log('a', a.connectionState));
b.addEventListener('connectionstatechange', () => console.log('b', b.connectionState));

a.createDataChannel('');
await a.setLocalDescription();
while (a.iceGatheringState != 'complete') await new Promise(res => a.addEventListener('icegatheringstatechange', res, {once: true}));

await b.setRemoteDescription(a.localDescription);
await b.setLocalDescription();
while (b.iceGatheringState != 'complete') await new Promise(res => b.addEventListener('icegatheringstatechange', res, {once: true}));

await a.setRemoteDescription(b.localDescription);
</script>
